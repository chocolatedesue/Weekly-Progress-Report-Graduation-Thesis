对于分域的参考帮助：

不同域内可以有不同的偏好设定
本身不生产 不存在的路由条目，只面向其他AS公布自己的可达路由
交换路径向量来避免环路
没有自动发现功能，需要手动配置邻居




参考文献: https://www.zhihu.com/question/415689038/answer/1420556454





BGP 中有许多重要的基础机制，正是这些机制确保了 BGP 能够稳定、可靠地运行，并支撑着庞大的互联网。以下列举一些最重要的基础机制：

1. 基于 TCP 的可靠传输：

BGP 使用 TCP（传输控制协议）作为其传输层协议。TCP 提供可靠的、面向连接的通信，确保 BGP 消息的可靠传输，包括消息的顺序、完整性和无差错。

TCP 的可靠性对于 BGP 至关重要，因为路由信息的错误或丢失可能会导致严重的网络问题。

2. 增量更新机制：

BGP 采用增量更新机制，只在路由发生变化时才发送 UPDATE 消息。这与一些距离矢量协议的定期全量更新机制不同。

增量更新机制大大减少了 BGP 的带宽消耗和处理开销，提高了效率。

3. 路径属性 (Path Attributes):

路径属性是 BGP UPDATE 消息中携带的关键信息，用于描述路由的特征和属性。

BGP 利用丰富的路径属性来进行路由选择和策略控制。重要的路径属性包括：

AS_PATH： 记录路由经过的 AS 路径，是 BGP 防止环路的核心机制。

NEXT_HOP： 指示到达目标网络的下一跳路由器地址。

ORIGIN： 标明路由的起源（IGP、EGP 或 Incomplete）。

LOCAL_PREF： 在 AS 内部用于优选出口路由。

MULTI_EXIT_DISC (MED)： 用于在具有多个入口/出口点的 AS 之间优选路由。

4. 路由策略 (Routing Policies):

BGP 允许网络管理员通过配置路由策略来控制路由的接收、选择和通告。

路由策略可以基于各种属性（如 AS_PATH、前缀、团体属性等）进行过滤和修改，从而实现流量工程、安全控制等目的。

导入策略用于控制如何选择路由并将其存入 Loc-RIB。导出策略用于控制如何将路由通告给对等体。

5. 路由选择机制 (BGP Decision Process):

BGP 发言者使用一套复杂的决策过程来选择到达特定目的地的最佳路由。

该过程基于一系列的比较规则，依次比较多个路径属性，直到选出最优路径。

常见的规则例如：优选最大 LOCAL_PREF 值的路由，优选最短 AS_PATH 的路由等等。

6. 环路避免机制 (Loop Avoidance):

BGP 主要依靠 AS_PATH 属性来避免路由环路。

当 BGP 发言者收到一个 UPDATE 消息，如果发现 AS_PATH 中已经包含了自己的 AS 号，则会丢弃该路由，从而避免环路。

对于 iBGP，引入了额外的规则来防止环路，即不会将从一个 iBGP 对等体学到的路由通告给另一个 iBGP 对等体。

7. 路由聚合 (Route Aggregation):

BGP 支持路由聚合，可以将多个具体的路由汇总成一个更通用的路由，从而减少路由表的大小，提高路由效率。

聚合路由时可以使用 ATOMIC_AGGREGATE 和 AGGREGATOR 属性来传递聚合信息。

8. 路由抖动抑制 (Route Flap Damping):

路由抖动抑制机制用于减少由于链路不稳定等原因造成的路由频繁更新，从而提高网络的稳定性。

该机制通过对抖动的路由进行惩罚，并在一段时间内抑制不稳定的路由，来减少路由抖动对网络的影响。

9. iBGP 的可扩展性机制 (Scalability Mechanisms for iBGP):

由于 iBGP 的全互联要求，在大型 AS 内部，iBGP 会话数量会随着 BGP 发言者数量的增加而急剧增长。

为了解决 iBGP 的可扩展性问题，BGP 引入了以下两种机制：

路由反射 (Route Reflection)： 通过引入路由反射器来减少 iBGP 会话数量。

联盟 (Confederation)： 将一个大型 AS 划分成多个小型 AS，以减少单个 AS 内部的 iBGP 会话数量。

这些基础机制相互配合，使得 BGP 成为一个强大、灵活且可扩展的路由协议，能够支撑全球互联网的运行。它们保证了 BGP 的可靠性、稳定性、安全性以及对各种复杂网络环境的适应性。

